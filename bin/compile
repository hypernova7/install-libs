#!/usr/bin/env node

const { env } = process
const v = env.SOURCE_VERSION
const fs = require('fs')
const path = require('path')
const { exec } = require('child_process')
const log = () => console.log.apply(null, arguments)
const write = (val) => {
  return exec(val, (error, stdout, stderr) => {
    if (error) {
      log(`error: ${error.message}`);
      return;
    }
    if (stderr) {
      log(`stderr: ${stderr}`);
      return;
    }
    log(`stdout: ${stdout}`);
  })
}
if (!v) {
  log('Not found env SOURCE_VERSION')
  process.exit(0)
} else {
  write(`
    if [ -z "${v}" ]; then
      echo "Not found env SOURCE_VERSION"
      exit 0
    fi
    echo "RELEASE=${v}" >> $1/.env
  `)
}
