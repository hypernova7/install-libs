#!/usr/bin/env node

const { env } = process
const v = env.SOURCE_VERSION
const fs = require('fs')
const path = require('path')
const { exec } = require('child_process')
const log = () => console.log.apply(null, arguments)
const write = (val) => {
  return exec(val, (error, stdout, stderr) => {
    if (error) {
      console.log(`error: ${error.message}`);
      return;
    }
    if (stderr) {
      console.log(`stderr: ${stderr}`);
      return;
    }
    console.log(`stdout: ${stdout}`);
  })
}
const rewrite = (val) => {
  return fs.appendFile(path.resolve(process.cwd(), '.env', val, (e) => {
    if (e) log(e.toString())
  })
}
if (!v) {
  log('Not found env SOURCE_VERSION')
  process.exit(0)
} else {
  rewrite(`\nRELEASE=${v}\nSOURCE_VERSION=${v}`)
  log(JSON.stringify(env))
}
